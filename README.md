# Mini Webpack

ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ Webpack å®ç°ï¼Œç”¨äºå­¦ä¹ å’Œç†è§£ Webpack çš„æ ¸å¿ƒå·¥ä½œåŸç†ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

é€šè¿‡å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ Webpackï¼Œæ·±å…¥ç†è§£ç°ä»£å‰ç«¯æ„å»ºå·¥å…·çš„æ ¸å¿ƒæœºåˆ¶ï¼š
- æ¨¡å—ä¾èµ–è§£æ
- AST è¯­æ³•æ ‘åˆ†æ
- ä»£ç è½¬æ¢å’Œæ‰“åŒ…
- æ¨¡å—åŠ è½½æœºåˆ¶

## ğŸ—ï¸ æ ¸å¿ƒå®ç°

### ä¸‰å¤§æ ¸å¿ƒé˜¶æ®µ

1. **åˆå§‹åŒ–é˜¶æ®µ (Initialization)**
   - è¯»å–é…ç½®æ–‡ä»¶
   - åˆ›å»º Compiler å®ä¾‹
   - è®¾ç½®å…¥å£ç‚¹

2. **ç¼–è¯‘é˜¶æ®µ (Compilation)**
   - è§£æå…¥å£æ¨¡å—
   - æ„å»ºä¾èµ–å›¾
   - å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ï¼ˆJSã€CSSï¼‰
   - ä½¿ç”¨ Babel è¿›è¡Œä»£ç è½¬æ¢

3. **è¾“å‡ºé˜¶æ®µ (Emission)**
   - ç”Ÿæˆæœ€ç»ˆçš„ bundle ä»£ç 
   - å®ç° `__webpack_require__` è¿è¡Œæ—¶
   - å†™å…¥è¾“å‡ºæ–‡ä»¶

### æŠ€æœ¯æ ˆ

- **Node.js** - è¿è¡Œç¯å¢ƒ
- **Babel** - AST è§£æå’Œä»£ç è½¬æ¢
  - `@babel/parser` - è§£æ JavaScript ä»£ç ä¸º AST
  - `@babel/traverse` - éå† AST æå–ä¾èµ–
  - `@babel/core` - ä»£ç è½¬æ¢
- **Path** - è·¯å¾„å¤„ç†
- **FS** - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

## ğŸ“ é¡¹ç›®ç»“æ„

```
mini-webpack/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.js              # Mini Webpack æ ¸å¿ƒå®ç°
â”œâ”€â”€ example/                  # ç¤ºä¾‹é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.js          # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ helpers.js     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ ui.js         # UI å·¥å…·
â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”‚   â””â”€â”€ main.css      # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â””â”€â”€ ComponentA.js # ç»„ä»¶æ¨¡å—
â”‚   â”œâ”€â”€ dist/
â”‚   â”‚   â””â”€â”€ bundle.js         # æ„å»ºè¾“å‡º
â”‚   â”œâ”€â”€ index.html            # HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ build.js              # æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ package.json          # é¡¹ç›®é…ç½®
â”œâ”€â”€ package.json              # ä¸»é¡¹ç›®é…ç½®
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…ä¸»é¡¹ç›®ä¾èµ–
pnpm install

# è¿›å…¥ç¤ºä¾‹é¡¹ç›®
cd example
npm run build
# è¿™é‡Œæ‰“å¼€example/index.htmlæŸ¥çœ‹æ•ˆæœ


```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ç”¨æ³•

```javascript
const MiniWebpack = require('./src/index.js');

const config = {
  entry: './src/index.js',
  output: {
    path: './dist',
    filename: 'bundle.js'
  }
};

const compiler = new MiniWebpack(config);
compiler.run();
```

### æ”¯æŒçš„è¯­æ³•

- âœ… ES6 æ¨¡å— (`import`/`export`)
- âœ… CommonJS (`require`/`module.exports`)
- âœ… CSS æ–‡ä»¶å¯¼å…¥
- âœ… åŠ¨æ€å¯¼å…¥ (`import()`)
- âœ… ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„

### æ„å»ºè¿‡ç¨‹

1. **ä¾èµ–è§£æ**ï¼šä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé€’å½’è§£ææ‰€æœ‰ä¾èµ–
2. **ä»£ç è½¬æ¢**ï¼šä½¿ç”¨ Babel å°† ES6+ ä»£ç è½¬æ¢ä¸º ES5
3. **æ¨¡å—æ‰“åŒ…**ï¼šå°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶
4. **è¿è¡Œæ—¶æ³¨å…¥**ï¼šæ³¨å…¥ `__webpack_require__` è¿è¡Œæ—¶

## ğŸ”§ æ ¸å¿ƒç‰¹æ€§

### æ¨¡å—ç³»ç»Ÿ

- **æ¨¡å—ç¼“å­˜**ï¼šé¿å…é‡å¤åŠ è½½
- **å¾ªç¯ä¾èµ–å¤„ç†**ï¼šæ”¯æŒæ¨¡å—é—´çš„å¾ªç¯å¼•ç”¨
- **è·¯å¾„è§£æ**ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„

### ä»£ç è½¬æ¢

- **ES6 â†’ ES5**ï¼šä½¿ç”¨ Babel è¿›è¡Œè¯­æ³•è½¬æ¢
- **æ¨¡å—è½¬æ¢**ï¼šES6 æ¨¡å—è½¬æ¢ä¸º CommonJS
- **CSS å¤„ç†**ï¼šå°† CSS è½¬æ¢ä¸º JavaScript ä»£ç 

### è¿è¡Œæ—¶æœºåˆ¶

```javascript
// ç”Ÿæˆçš„è¿è¡Œæ—¶ä»£ç 
(function(modules) {
  var installedModules = {};
  
  function __webpack_require__(moduleId) {
    // æ¨¡å—åŠ è½½é€»è¾‘
  }
  
  return __webpack_require__("å…¥å£æ¨¡å—ID");
})({
  "æ¨¡å—ID": function(module, exports, require) {
    // æ¨¡å—ä»£ç 
  }
});
```

## ğŸ“Š ç¤ºä¾‹é¡¹ç›®

ç¤ºä¾‹é¡¹ç›®åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

- **å·¥å…·å‡½æ•°æ¨¡å—**ï¼šæä¾›å¸¸ç”¨çš„å·¥å…·å‡½æ•°
- **UI ç»„ä»¶æ¨¡å—**ï¼šåˆ›å»ºäº¤äº’å¼ UI å…ƒç´ 
- **æ ·å¼æ–‡ä»¶**ï¼šç°ä»£åŒ–çš„ CSS æ ·å¼
- **åŠ¨æ€å¯¼å…¥**ï¼šæ¼”ç¤ºä»£ç åˆ†å‰²åŠŸèƒ½

### è¿è¡Œæ•ˆæœ

- ğŸ¨ æ¸å˜èƒŒæ™¯è®¾è®¡
- ğŸ¯ äº¤äº’å¼æŒ‰é’®
- ğŸ“± å“åº”å¼å¸ƒå±€
- âš¡ åŠ¨æ€ç»„ä»¶åŠ è½½

## ğŸ“ å­¦ä¹ ä»·å€¼

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥å­¦ä¹ åˆ°ï¼š

1. **Webpack å·¥ä½œåŸç†**ï¼šç†è§£ç°ä»£æ„å»ºå·¥å…·çš„æ ¸å¿ƒæœºåˆ¶
2. **AST æ“ä½œ**ï¼šå­¦ä¹ å¦‚ä½•è§£æå’Œæ“ä½œæŠ½è±¡è¯­æ³•æ ‘
3. **æ¨¡å—ç³»ç»Ÿ**ï¼šæ·±å…¥ç†è§£ JavaScript æ¨¡å—åŠ è½½æœºåˆ¶
4. **ä»£ç è½¬æ¢**ï¼šæŒæ¡ä»£ç è½¬æ¢å’Œä¼˜åŒ–çš„æŠ€æœ¯
5. **æ„å»ºå·¥å…·è®¾è®¡**ï¼šå­¦ä¹ å¦‚ä½•è®¾è®¡è‡ªå·±çš„æ„å»ºå·¥å…·

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–æå–ç­–ç•¥

```javascript
// ä½¿ç”¨ Babel è§£æ AST
const ast = parse(source, {
  sourceType: 'module',
  plugins: ['jsx', 'typescript', 'decorators-legacy']
});

// æå– import å£°æ˜
traverse(ast, {
  ImportDeclaration: ({ node }) => {
    dependencies.push(node.source.value);
  }
});
```

### è·¯å¾„è§£ææœºåˆ¶

```javascript
// æ”¯æŒå¤šç§æ–‡ä»¶æ‰©å±•å
const extensions = ['.js', '.jsx', '.ts', '.tsx', '.css'];

// ç›¸å¯¹è·¯å¾„è§£æ
const resolveModulePath = (from, to) => {
  const ext = path.extname(to);
  if (ext) return path.resolve(path.dirname(from), to);
  
  for (const ext of extensions) {
    const fullPath = path.resolve(path.dirname(from), to + ext);
    if (fs.existsSync(fullPath)) return fullPath;
  }
};
```

## ğŸ“ å¼€å‘æ—¥å¿—

- âœ… å®ç°åŸºæœ¬çš„æ¨¡å—è§£æ
- âœ… é›†æˆ Babel è¿›è¡Œä»£ç è½¬æ¢
- âœ… æ”¯æŒ CSS æ–‡ä»¶å¤„ç†
- âœ… å®ç°æ¨¡å—ç¼“å­˜æœºåˆ¶
- âœ… ä¼˜åŒ–è·¯å¾„è§£æé€»è¾‘
- âœ… å®Œå–„é”™è¯¯å¤„ç†

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

MIT License

---

**ç›¸å…³èµ„æº**ï¼š
- [Webpack å®˜æ–¹æ–‡æ¡£](https://webpack.js.org/)
- [Babel å®˜æ–¹æ–‡æ¡£](https://babeljs.io/)
- [AST Explorer](https://astexplorer.net/)